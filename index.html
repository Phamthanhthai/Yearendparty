<!doctype html>
<html lang="vi">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>T·∫•t ni√™n Gia ƒê√¨nh Nh√† T√°o</title>

<!-- Gi·∫£m cache (kh√¥ng ƒë·∫£m b·∫£o 100% v√¨ CDN, nh∆∞ng gi√∫p ƒë·ª° h∆°n) -->
<meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate"/>
<meta http-equiv="Pragma" content="no-cache"/>
<meta http-equiv="Expires" content="0"/>

<style>
:root{
  --gold:#ffd666;
  --card:rgba(255,255,255,.10);
  --card2:rgba(255,255,255,.06);
  --text:#fff;
}
*{box-sizing:border-box}
html,body{
  margin:0;height:100%;
  font-family:system-ui,-apple-system,Segoe UI,Roboto;
  color:var(--text);
  background:
    radial-gradient(1000px 600px at 10% -10%, rgba(255,214,102,.25), transparent 60%),
    radial-gradient(1000px 600px at 90% -10%, rgba(179,0,0,.35), transparent 60%),
    linear-gradient(180deg,#000,#120000);
}

.center{
  min-height:100vh;
  display:flex;
  align-items:center;
  justify-content:center;
  padding:16px;
}
.panel{
  background:linear-gradient(180deg, rgba(255,255,255,.10), rgba(255,255,255,.05));
  border:1px solid rgba(255,255,255,.14);
  box-shadow:0 30px 70px rgba(0,0,0,.55);
  padding:22px;
  border-radius:18px;
  max-width:420px;
  width:100%;
  text-align:center;
  backdrop-filter: blur(10px);
}
h2{margin:0 0 10px}
input{
  width:100%;
  padding:12px;
  border-radius:12px;
  border:1px solid rgba(255,255,255,.22);
  background:rgba(0,0,0,.15);
  color:#fff;
  margin-top:10px;
}
.btn{
  margin-top:12px;
  width:100%;
  padding:12px;
  border-radius:14px;
  border:none;
  font-weight:800;
  cursor:pointer;
  background:linear-gradient(90deg,var(--gold),#fff2a8);
  color:#4b2c00;
}
.btn.secondary{
  background:rgba(0,0,0,.25);
  color:#fff;
  border:1px solid rgba(255,255,255,.20);
}
.small{opacity:.78;font-size:13px;margin-top:8px;line-height:1.35}
.hidden{display:none}

/* Invite */
.wrap{max-width:760px;margin:auto;padding:16px}
.invite{
  display:none;
  background:linear-gradient(180deg, rgba(255,255,255,.10), rgba(255,255,255,.05));
  border:1px solid rgba(255,255,255,.14);
  padding:18px;
  border-radius:20px;
  box-shadow:0 30px 70px rgba(0,0,0,.55);
}
.top{
  text-align:center;
  padding:10px 6px 0;
}
.badge{
  display:inline-block;
  padding:8px 16px;
  border-radius:999px;
  background:linear-gradient(90deg,var(--gold),#fff2a8);
  color:#4b2c00;
  font-weight:900;
  letter-spacing:.4px;
}
.top h2{margin:10px 0 6px}
.top p{margin:0;opacity:.9}

.grid{
  margin-top:14px;
  display:grid;
  gap:10px;
}
.box{
  background:var(--card2);
  border:1px solid rgba(255,255,255,.12);
  padding:12px;
  border-radius:12px;
}
.box b{color:var(--gold)}
iframe.map{
  border-radius:14px;
  border:0;
  width:100%;
  height:260px;
  margin-top:12px;
}
.row{
  display:grid;
  gap:10px;
  margin-top:12px;
}
@media (min-width:720px){
  .row{grid-template-columns:1fr 1fr}
}

/* Countdown */
.countdown{
  margin-top:12px;
  display:flex;
  gap:10px;
  justify-content:center;
  flex-wrap:wrap;
}
.timebox{
  min-width:92px;
  background:rgba(0,0,0,.22);
  border:1px solid rgba(255,255,255,.14);
  border-radius:14px;
  padding:10px 12px;
}
.timebox .num{font-size:26px;font-weight:900}
.timebox .lbl{font-size:12px;opacity:.85}

/* Music mini player */
.player{
  margin-top:12px;
  background:rgba(0,0,0,.22);
  border:1px solid rgba(255,255,255,.14);
  border-radius:14px;
  padding:12px;
}
.player .title{font-weight:800}
.player .hint{font-size:12px;opacity:.8;margin-top:6px}
.player .controls{display:flex;gap:10px;flex-wrap:wrap;margin-top:10px}
.player .controls button{flex:1}

/* Fireworks */
canvas{position:fixed;inset:0;pointer-events:none}
</style>
</head>

<body>

<canvas id="fx"></canvas>

<!-- STEP 1 -->
<div class="center" id="step1">
  <div class="panel">
    <h2>üéâ Nh·∫≠p t√™n c·ªßa b·∫°n</h2>
    <div class="small">Ch·ªâ d√†nh cho: <b>Nga</b> ‚Ä¢ <b>Ho√†/H√≤a</b> ‚Ä¢ <b>Trang</b> ‚Ä¢ <b>Th√°i</b></div>
    <input id="guestName" placeholder="V√≠ d·ª•: Th√°i" autocomplete="off"/>
    <button class="btn" id="btnNext" type="button">Ti·∫øp t·ª•c</button>
    <div class="small" id="err"></div>
  </div>
</div>

<!-- STEP 2 -->
<div class="center hidden" id="step2">
  <div class="panel">
    <h2 id="ask"></h2>
    <button class="btn" id="btnYes" type="button">C√≥, m√¨nh tham gia üéä</button>
    <button class="btn secondary" id="btnNo" type="button">Kh√¥ng tham gia üò¢</button>
    <div class="small" style="margin-top:10px;opacity:.75">B·∫•m ch·ªçn gi√∫p gia ƒë√¨nh m√¨nh chu·∫©n b·ªã nh√© üçé</div>
  </div>
</div>

<!-- INVITE -->
<div class="wrap">
  <div class="invite" id="invite">
    <div class="top">
      <div class="badge">T·∫§T NI√äN GIA ƒê√åNH NH√Ä T√ÅO</div>
      <h2 id="guest"></h2>
      <p>Cu·ªëi nƒÉm r·ªìi, m√¨nh h·∫πn nhau t·ª• h·ªçp ƒÉn u·ªëng & t√°m chuy·ªán cho vui nha ‚ù§Ô∏è</p>

      <!-- Countdown -->
      <div class="countdown" aria-label="ƒê·∫øm ng∆∞·ª£c">
        <div class="timebox"><div class="num" id="d">--</div><div class="lbl">Ng√†y</div></div>
        <div class="timebox"><div class="num" id="h">--</div><div class="lbl">Gi·ªù</div></div>
        <div class="timebox"><div class="num" id="m">--</div><div class="lbl">Ph√∫t</div></div>
        <div class="timebox"><div class="num" id="s">--</div><div class="lbl">Gi√¢y</div></div>
      </div>
      <div class="small" id="countHint"></div>
    </div>

    <div class="row">
      <div class="grid">
        <div class="box">üìç <b>ƒê·ªãa ƒëi·ªÉm:</b> Linh Ch√°o (ƒê·ªìi Rada)</div>
        <div class="box">‚è∞ <b>Gi·ªù:</b> 19h30</div>
        <div class="box">üë®‚Äçüë©‚Äçüëß‚Äçüë¶ <b>Nh√≥m:</b> Gia ƒê√¨nh Nh√† T√°o</div>
        <div class="box">‚úÖ <b>Tr·∫°ng th√°i:</b> <span id="statusText">‚Äî</span></div>
      </div>

      <div>
        <div class="player">
          <div class="title">üéµ Nh·∫°c T·∫øt</div>
          <div class="hint">Do tr√¨nh duy·ªát ch·∫∑n t·ª± ph√°t, b·∫°n c·∫ßn b·∫•m ‚ÄúB·∫≠t nh·∫°c‚Äù m·ªôt l·∫ßn nh√©.</div>
          <div class="controls">
            <button class="btn" id="musicToggle" type="button">‚ñ∂ B·∫≠t nh·∫°c</button>
            <button class="btn secondary" id="boomBtn" type="button">üéÜ B·∫Øn ph√°o hoa</button>
          </div>

          <!-- YouTube player (·∫©n) -->
          <div id="ytWrap" style="margin-top:10px;display:none">
            <div id="player"></div>
            <div class="small">N·∫øu kh√¥ng nghe th·∫•y, h√£y b·∫•m l·∫°i ‚ÄúB·∫≠t nh·∫°c‚Äù.</div>
          </div>
        </div>
      </div>
    </div>

    <!-- Google Map -->
    <iframe class="map"
      src="https://www.google.com/maps?q=Linh%20Ch%C3%A1o%20%C4%90%E1%BB%93i%20Rada&output=embed"
      loading="lazy">
    </iframe>

    <div class="small" style="text-align:center;margin-top:10px">
      üìå Link ch·ªâ ƒë∆∞·ªùng (Google Maps): 
      <a href="https://maps.app.goo.gl/bnpZXjber8uW5tyDA?g_st=ipc" target="_blank" rel="noopener noreferrer"
         style="color:#ffe9a6;text-decoration:underline">M·ªü Google Maps</a>
    </div>

    <div class="small" style="text-align:center;margin-top:10px;opacity:.85">
      H·∫πn g·∫∑p b·∫°n l√∫c 19h30 nha üçª
    </div>
  </div>
</div>

<!-- YouTube IFrame API -->
<script src="https://www.youtube.com/iframe_api"></script>

<script>
/* ================== Fireworks ================== */
const cv = document.getElementById("fx");
const ctx = cv.getContext("2d");
let W,H; function resize(){ W=cv.width=innerWidth; H=cv.height=innerHeight; }
resize(); addEventListener("resize", resize);

let parts = [];
function boom(x0,y0){
  for(let i=0;i<70;i++){
    parts.push({x:x0,y:y0,a:Math.random()*Math.PI*2,s:Math.random()*5+2});
  }
}
(function anim(){
  ctx.clearRect(0,0,W,H);
  for(const p of parts){
    p.x += Math.cos(p.a)*p.s;
    p.y += Math.sin(p.a)*p.s;
    p.s *= 0.95;
    ctx.fillStyle = "gold";
    ctx.fillRect(p.x,p.y,3,3);
  }
  parts = parts.filter(p=>p.s>0.6);
  requestAnimationFrame(anim);
})();

function boomCorners(){
  boom(0,0); boom(W,0); boom(0,H); boom(W,H);
}

/* ================== Normalize Vietnamese ================== */
function normalizeVN(str){
  return str
    .toLowerCase()
    .normalize("NFD")
    .replace(/[\u0300-\u036f]/g,"")
    .replace(/ƒë/g,"d")
    .trim();
}

/* ================== DOM ================== */
const inputName = document.getElementById("guestName");
const err = document.getElementById("err");
const step1 = document.getElementById("step1");
const step2 = document.getElementById("step2");
const ask = document.getElementById("ask");

const invite = document.getElementById("invite");
const guest = document.getElementById("guest");
const statusText = document.getElementById("statusText");

const btnNext = document.getElementById("btnNext");
const btnYes = document.getElementById("btnYes");
const btnNo  = document.getElementById("btnNo");
const boomBtn = document.getElementById("boomBtn");

const dEl=document.getElementById("d");
const hEl=document.getElementById("h");
const mEl=document.getElementById("m");
const sEl=document.getElementById("s");
const countHint=document.getElementById("countHint");

/* ================== Rules ================== */
const allow = ["nga","hoa","trang","thai"];

/* ================== Countdown to 19:30 ================== */
function getNext1930(){
  const now = new Date();
  const t = new Date(now);
  t.setHours(19,30,0,0);
  if(t.getTime() <= now.getTime()){
    t.setDate(t.getDate()+1);
  }
  return t;
}
let target = getNext1930();

function pad2(n){ return String(n).padStart(2,"0"); }

function tickCountdown(){
  const now = new Date();
  let diff = target.getTime() - now.getTime();

  if(diff <= 0){
    // ƒë√£ t·ªõi gi·ªù => ƒë·∫∑t l·∫°i sang ng√†y mai 19:30
    target = getNext1930();
    diff = target.getTime() - now.getTime();
  }

  const sec = Math.floor(diff/1000);
  const days = Math.floor(sec/86400);
  const hours = Math.floor((sec%86400)/3600);
  const mins = Math.floor((sec%3600)/60);
  const secs = sec%60;

  dEl.textContent = pad2(days);
  hEl.textContent = pad2(hours);
  mEl.textContent = pad2(mins);
  sEl.textContent = pad2(secs);

  // g·ª£i √Ω ng√†y gi·ªù m·ª•c ti√™u
  const dd = pad2(target.getDate());
  const MM = pad2(target.getMonth()+1);
  countHint.textContent = `‚è≥ ƒê·∫øm ng∆∞·ª£c t·ªõi 19h30 (${dd}/${MM})`;
}
setInterval(tickCountdown, 1000);
tickCountdown();

/* ================== Flow ================== */
function goNext(){
  const raw = inputName.value.trim();
  const n = normalizeVN(raw);

  if(!allow.includes(n)){
    err.textContent = "T√™n n√†y kh√¥ng n·∫±m trong danh s√°ch gia ƒë√¨nh üòä";
    return;
  }

  err.textContent = "";
  step1.classList.add("hidden");
  step2.classList.remove("hidden");
  ask.textContent = `${raw} ∆°i, t·ªëi nay ƒëi t·∫•t ni√™n c√πng gia ƒë√¨nh nh√©?`;
}

function finish(ok){
  const raw = inputName.value.trim();

  // l∆∞u local
  localStorage.setItem("yearend_"+raw, ok ? "C√≥" : "Kh√¥ng");

  step2.classList.add("hidden");
  invite.style.display="block";
  guest.textContent = `${raw} th√¢n m·∫øn`;

  statusText.textContent = ok ? "C√≥ tham gia üéâ" : "Kh√¥ng tham gia üò¢";

  if(ok) boomCorners();
}

btnNext.addEventListener("click", goNext);
inputName.addEventListener("keydown", (e)=>{
  if(e.key === "Enter"){ e.preventDefault(); goNext(); }
});
btnYes.addEventListener("click", ()=>finish(true));
btnNo.addEventListener("click", ()=>finish(false));
boomBtn.addEventListener("click", boomCorners);

/* ================== YouTube Music ================== */
let ytPlayer = null;
let ytReady = false;
let playing = false;

// Video ID c·ªßa link b·∫°n g·ª≠i: KdG2k8WHexA
const YT_VIDEO_ID = "KdG2k8WHexA";

function onYouTubeIframeAPIReady(){
  ytPlayer = new YT.Player("player", {
    height: "220",
    width: "100%",
    videoId: YT_VIDEO_ID,
    playerVars: {
      autoplay: 0,
      controls: 1,
      rel: 0,
      modestbranding: 1,
      playsinline: 1
    },
    events: {
      onReady: () => { ytReady = true; },
      onStateChange: (e) => {
        // 1 = playing, 2 = paused
        if(e.data === 1){
          playing = true;
          document.getElementById("musicToggle").textContent = "‚è∏ T·∫Øt nh·∫°c";
        }else if(e.data === 2 || e.data === 0){
          playing = false;
          document.getElementById("musicToggle").textContent = "‚ñ∂ B·∫≠t nh·∫°c";
        }
      }
    }
  });
}
window.onYouTubeIframeAPIReady = onYouTubeIframeAPIReady;

const musicToggle = document.getElementById("musicToggle");
const ytWrap = document.getElementById("ytWrap");

musicToggle.addEventListener("click", ()=>{
  ytWrap.style.display = "block";

  // API c√≥ th·ªÉ ch∆∞a k·ªãp ready trong v√†i t√≠ch t·∫Øc
  if(!ytPlayer || !ytReady){
    // c·ªë g·∫Øng l·∫°i sau 300ms
    setTimeout(()=>musicToggle.click(), 300);
    return;
  }

  if(!playing){
    ytPlayer.playVideo(); // c·∫ßn user click => OK
    boomCorners();
  }else{
    ytPlayer.pauseVideo();
  }
});
</script>

</body>
</html>
